<tbody>
  <% users.forEach(user => { %>
    <tr>
      <td><%= user.username %></td>
      <% for (let y = startYear; y <= endYear; y++) { %>
        <% 
          let moisDebut = (y === startYear) ? startMonth : 1;
          let moisFin   = (y === endYear)   ? endMonth   : 12;
        %>
        <% for (let m = moisDebut; m <= moisFin; m++) { 
             let pointage = dependencies.pointage.find(p => {
               let d = new Date(p.date);
               return p.users_id === user.id &&
                      d.getFullYear() === parseInt(y) &&
                      d.getMonth() + 1 === parseInt(m);
             });
        %>
          <td><%= pointage ? pointage.heure : "-" %></td>
        <% } %>
      <% } %>
      <td>
        <%= dependencies.pointage
              .filter(p => p.users_id === user.id &&
                           new Date(p.date).getFullYear() >= startYear &&
                           new Date(p.date).getFullYear() <= endYear)
              .reduce((acc, p) => acc + p.heure, 0) %>
      </td>
      <td>
        <a href="/user/<%= user.id %>?lotpi=<%= lotpi.id %>&year=<%= year %>" 
           class="btn btn-sm btn-primary">Voir</a>
      </td>
    </tr>
  <% }) %>
</tbody>
