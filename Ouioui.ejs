<thead>
  <tr>
    <th>Utilisateur</th>
    <% for (let y = startYear; y <= endYear; y++) { %>
      <% 
        // définir début/fin des mois pour cette année
        let moisDebut = (y === startYear) ? startMonth : 1;
        let moisFin   = (y === endYear)   ? endMonth   : 12;
      %>
      <% for (let m = moisDebut; m <= moisFin; m++) { %>
        <th><%= new Date(y, m - 1).toLocaleString("fr-FR", { month: "long" }) %> <%= y %></th>
      <% } %>
    <% } %>
    <th>Action</th>
  </tr>
</thead>
<tbody>
  <% dependencies.user.forEach(user => { %>
    <tr>
      <td><%= user.username %></td>
      <% for (let y = startYear; y <= endYear; y++) { %>
        <% 
          let moisDebut = (y === startYear) ? startMonth : 1;
          let moisFin   = (y === endYear)   ? endMonth   : 12;
        %>
        <% for (let m = moisDebut; m <= moisFin; m++) { 
             let pointPourMois = null;
             dependencies.pointage.forEach(point => {
               let d = new Date(point.date);
               if (point.users_id === user.id && d.getMonth() + 1 === parseInt(m) && d.getFullYear() === y) {
                 pointPourMois = point;
               }
             });
        %>
          <td><%= pointPourMois ? pointPourMois.heure : "-" %></td>
        <% } %>
      <% } %>
      <td>
        <a href="/user/<%= user.id %>?lotpi=<%= lotpi.id %>&year=<%= year %>" class="btn btn-sm btn-primary">Voir</a>
      </td>
    </tr>
  <% }) %>
</tbody>
